# 对 Lean4 证明中 `sorry` 引理的分析与证明流程

本文档旨在为 Lean4 证明中的两个核心引理 `simple_swap_contradiction` 和 `derive_b_g_equality_from_constraints` 提供详细的证明思路，以填补其中 `sorry` 留下的逻辑空白。

---

## 1. `simple_swap_contradiction` 引理分析

### **目標 (Goal)**

此引理需要证明一个矛盾 (`False`)。

### **已知條件 (Premises)**

1.  系统满足公理 A1 (向量b唯一性) 和 A2 (矩阵M无全零列)。
2.  存在一个索引（零向量 $\vec{0}$），其置换为 `Id` ($P(\vec{0}) = \text{Id}$)。
3.  存在另一个索引 $i_b$，其置换为 `Swap` ($P(i_b) = \sigma$)。

### **證明流程 (Proof Flow)**

此流程旨在证明，如果系统中同时允许 `Id` 和 `Swap` 作为合法的置换，那么系统常量 `M` 和 `b` 必须满足一组互相矛盾的约束。

1.  **推导 `Id` 带来的约束**:
    * 从 $P(\vec{0}) = \text{Id}$ 前提，可直接得到（或调用 `zero_vector_identity_constraints` 引理）：
      $$b_{f0} = b_{g0} \quad \text{且} \quad b_{f1} = b_{g1}$$

2.  **利用差分法推导全局约束**:
    * 只要 `Id` 是系统中一个合法的置换，那么对于任意 $i_1, i_2 \in \mathcal{I}$，差分方程 $(M_{f0} - M_{g0})(i_1 - i_2) = \vec{0}$ 必须成立。由于 $(i_1 - i_2)$ 可以张成全空间，这必然要求 $M_{f0} = M_{g0}$。
    * 只要 `Swap` 是系统中一个合法的置换，同理可推导出 $M_{f0} = M_{g1}$。

3.  **整合约束并导出矛盾**:
    * 如果 `Id` 和 `Swap` 在解集中共存，那么上述两个关于矩阵的结论必须同时成立，即：$M_{g0} = M_{f0} = M_{g1}$。
    * 现在，回到**未消去 b** 的原始核心方程。我们已知存在一个 $i_b$ 其对应的置换为 $P(i_b) = \sigma$。其方程为：
      $$(M_{f0} - M_{g1})i_b = b_{g1} - b_{f0}$$
    * 将我们已经推导出的所有结论代入此方程：
        * 将 $M_{g1}$ 替换为 $M_{g0}$ (因为 $M_{g0}=M_{g1}$)
        * 将 $b_{f0}$ 替换为 $b_{g0}$ (来自第1步)
    * 方程变为：
        $$(M_{f0} - M_{g0})i_b = b_{g1} - b_{g0}$$
    * 又因为 `Id` 的存在要求 $M_{f0} = M_{g0}$，所以方程左边为 $\vec{0}$：
        $$\vec{0} = b_{g1} - b_{g0}$$
    * 这意味着 $b_{g0} = b_{g1}$。

4.  **最终矛盾**:
    * 结论 $b_{g0} = b_{g1}$ 与**公理 A1** ($b_{g0} \neq b_{g1}$) 发生直接矛盾。
    * 因此，初始假设（`Id` 和 `Swap` 共存）不成立，引理得证。

---

## 2. `derive_b_g_equality_from_constraints` 引理分析

### **目標 (Goal)**

此引理需要证明一个等式：$b_{g0} = b_{g1}$。

### **已知條件 (Premises)**

1.  系统满足公理 A1 和 A2。
2.  存在一个索引（零向量 $\vec{0}$），其置换为 `Swap` ($P(\vec{0}) = \sigma$)。
3.  存在另一个索引 $i_a$，其置换为 `Id` ($P(i_a) = \text{Id}$)。

### **證明流程 (Proof Flow)**

此流程与上一个引理对称，但起点不同。

1.  **推导 `Swap` 带来的约束**:
    * 从 $P(\vec{0}) = \sigma$ 前提，可直接得到（或调用 `zero_vector_swap_constraints` 引理）：
      $$b_{f0} = b_{g1} \quad \text{且} \quad b_{f1} = b_{g0}$$

2.  **利用差分法推导全局约束**:
    * 和之前一样，系统中 `Id` 和 `Swap` 的共存，必然要求 $M_{g0} = M_{g1}$。

3.  **整合约束并导出结论**:
    * 我们回到**未消去 b** 的原始核心方程。我们已知存在一个 $i_a$ 其对应的置换为 $P(i_a) = \text{Id}$。其方程为：
      $$(M_{f0} - M_{g0})i_a = b_{g0} - b_{f0}$$
    * 将我们已经推导出的所有结论代入此方程：
        * `Id` 的存在性要求 $M_{f0}=M_{g0}$ (来自差分法)。所以方程左边为 $\vec{0}$。
        * 将 $b_{f0}$ 替换为 $b_{g1}$ (来自第1步)。
    * 方程变为：
        $$\vec{0} = b_{g0} - b_{g1}$$
    * 这意味着 $b_{g0} = b_{g1}$。

4.  **完成证明**:
    * 我们成功地从已知条件推导出了引理的目标 $b_{g0} = b_{g1}$。证明完成。
